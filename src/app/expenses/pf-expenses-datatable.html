<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../component/ayd-datatable.html">
<link rel="import" href="../../mixin/ayd-firebase.html">
<link rel="import" href="../../mixin/ayd-redux.html">

<dom-module id="pf-expenses-datatable">
  <script> 
    class PfExpensesDatatable extends Aydin.ReduxMixin(Aydin.FirebaseMixin(AydDatatable)) {

      static get is() {
        return 'pf-expenses-datatable';
      }

      ready() {
        super.ready();
        this.onChildNodeAdded('expenses', data => this.dispatch({ type: EXPENSE.ADD, payload: { key: data.key, data: data.val() } }));
        this.onChildNodeRemoved('expenses', data => this.dispatch({ type: EXPENSE.REMOVE, payload: data.key }));
        this.onChildNodeChanged('expenses', data => this.dispatch({ type: EXPENSE.CHANGE, payload: { key: data.key, data: data.val() } }));
      }

      static get properties() {
        return {
          fields: {
            type: Array,
            readOnly: true,
            value: () => ({
              'frequency': 'Frequency',
              'description': 'Description',
              'amount': 'Amount'
            })
          },
          data: {
            type: Array,
            value: () => [],
            computed: 'computeFromState(state.expenses.data)',
            observer: '_onDataChanged'
          },
          selected: {
            type: Array,
            value: () => [],
            observer: '_onSelectedChanged'
          }
        }
      }

      _onSelectedChanged(newValue = [], oldValue = []) {
        if(newValue.length !== oldValue.length) {
          this.dispatch({type: EXPENSE.SELECT, payload: newValue});
        }
      }

    }
    window.customElements.define(PfExpensesDatatable.is, PfExpensesDatatable);
  </script>
</dom-module>
