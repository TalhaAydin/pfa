<script>
    class FirebaseDatabase {
        constructor(firebase) {
            this.database = firebase.database();
        }

        __ref(nodeLocation) {
            return this.database.ref(nodeLocation);
        }

        bindNodeToProperty(nodeLocation, propertyToBind, elementContext) {
            const ref = this.__ref(nodeLocation);
            ref.on('child_added', data => {
                elementContext.push(propertyToBind, Object.assign(data.val(), { key: data.key }));
            });

            ref.on('child_removed', data => {
                elementContext.splice(propertyToBind, elementContext.get(propertyToBind).findIndex(e => data.key === e.key), 1);
            });

            // @TODO Also handle changes
        }

        pushToNode(nodeLocation, varToPush) {
            return this.__ref(nodeLocation).push().set(varToPush);
        }

        removeNode(nodeLocation) {
            return this.__ref(nodeLocation).remove();
        }

    }

    class Firebase {
        constructor(firebaseObject) {
            this.firebaseObject = firebaseObject;
            this.initializeFirebase();
            this.initializeDatabase();
        }

        get firebaseConfig() {
            return {
                apiKey: "AIzaSyBV66yNWXGdqNBqfPc2EZQ4M8dCqGAINjU",
                authDomain: "personal-finance-app-fa8d3.firebaseapp.com",
                databaseURL: "https://personal-finance-app-fa8d3.firebaseio.com",
                projectId: "personal-finance-app-fa8d3",
                storageBucket: "personal-finance-app-fa8d3.appspot.com",
                messagingSenderId: "707314505670"
            }
        }

        initializeFirebase() {
            this.firebaseObject.initializeApp(this.firebaseConfig);
        }

        initializeDatabase() {
            this.database = new FirebaseDatabase(this.firebaseObject);
        }
    }
</script>